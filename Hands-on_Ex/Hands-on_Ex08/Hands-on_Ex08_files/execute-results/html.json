{
  "hash": "2cf454461ba7dea47555692a84591c3a",
  "result": {
    "markdown": "---\ntitle: \"Hands-on Exercise 8\"\ndate: \"Last updated on 10 June, 2023\"\nformat:\n  html:\n    code-fold: false\n    code-summary: \"code block\"\n---\n\n\n# Cloropleth Mapping in R\n\n## Loading the packages\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf, tmap, tidyverse, skimr)\n```\n:::\n\n\n## Importing data  \nDataset types used for this study are:  \n\n* ESRI Shapefile: `MP14_SUBZONE_WEB_PL`\n* aspatial data file: `respopagesextod2011to2020.csv`, with fields used as unique identifiers to geocode the shapefile\n\n::: panel-tabset\n## **ESRI Shapefile**\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz <- st_read(dsn = \"data/geospatial\", \n                layer = \"MP14_SUBZONE_WEB_PL\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `MP14_SUBZONE_WEB_PL' from data source \n  `C:\\haileycsy\\ISSS608-VAA\\Hands-on_Ex\\Hands-on_Ex08\\data\\geospatial' \n  using driver `ESRI Shapefile'\nSimple feature collection with 323 features and 15 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 2667.538 ymin: 15748.72 xmax: 56396.44 ymax: 50256.33\nProjected CRS: SVY21\n```\n:::\n\n```{.r .cell-code}\nskim(mpsz)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Couldn't find skimmers for class: sfc_MULTIPOLYGON, sfc; No\nuser-defined `sfl` provided. Falling back to `character`.\n```\n:::\n\n::: {.cell-output-display}\nTable: Data summary\n\n|                         |     |\n|:------------------------|:----|\n|Name                     |mpsz |\n|Number of rows           |323  |\n|Number of columns        |16   |\n|_______________________  |     |\n|Column type frequency:   |     |\n|character                |9    |\n|Date                     |1    |\n|numeric                  |6    |\n|________________________ |     |\n|Group variables          |None |\n\n\n**Variable type: character**\n\n|skim_variable | n_missing| complete_rate| min|   max| empty| n_unique| whitespace|\n|:-------------|---------:|-------------:|---:|-----:|-----:|--------:|----------:|\n|SUBZONE_N     |         0|             1|   4|    29|     0|      323|          0|\n|SUBZONE_C     |         0|             1|   6|     6|     0|      323|          0|\n|CA_IND        |         0|             1|   1|     1|     0|        2|          0|\n|PLN_AREA_N    |         0|             1|   4|    23|     0|       55|          0|\n|PLN_AREA_C    |         0|             1|   2|     2|     0|       55|          0|\n|REGION_N      |         0|             1|  11|    17|     0|        5|          0|\n|REGION_C      |         0|             1|   2|     3|     0|        5|          0|\n|INC_CRC       |         0|             1|  16|    16|     0|      323|          0|\n|geometry      |         0|             1| 642| 75093|     0|      323|          0|\n\n\n**Variable type: Date**\n\n|skim_variable | n_missing| complete_rate|min        |max        |median     | n_unique|\n|:-------------|---------:|-------------:|:----------|:----------|:----------|--------:|\n|FMEL_UPD_D    |         0|             1|2014-12-05 |2014-12-05 |2014-12-05 |        1|\n\n\n**Variable type: numeric**\n\n|skim_variable | n_missing| complete_rate|       mean|         sd|       p0|       p25|        p50|        p75|        p100|hist  |\n|:-------------|---------:|-------------:|----------:|----------:|--------:|---------:|----------:|----------:|-----------:|:-----|\n|OBJECTID      |         0|             1|     162.00|      93.39|     1.00|     81.50|     162.00|     242.50|      323.00|▇▇▇▇▇ |\n|SUBZONE_NO    |         0|             1|       4.63|       3.23|     1.00|      2.00|       4.00|       6.50|       17.00|▇▃▂▁▁ |\n|X_ADDR        |         0|             1|   27257.42|    7960.90|  5092.89|  21863.96|   28465.40|   31673.72|    50424.79|▁▃▇▃▁ |\n|Y_ADDR        |         0|             1|   36106.43|    5664.60| 19579.07|  31776.14|   35112.62|   39868.91|    49552.79|▁▅▇▅▂ |\n|SHAPE_Leng    |         0|             1|    6524.39|    6995.82|   871.55|   3709.64|    5211.87|    6942.61|    68083.94|▇▁▁▁▁ |\n|SHAPE_Area    |         0|             1| 2420881.68| 6566826.26| 39437.94| 628260.89| 1229894.42| 2106482.99| 69748298.79|▇▁▁▁▁ |\n:::\n:::\n\n## **aspatial data**\n\n::: {.cell}\n\n```{.r .cell-code}\npopdata <- read_csv(\"data/aspatial/respopagesextod2011to2020.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 984656 Columns: 7\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (5): PA, SZ, AG, Sex, TOD\ndbl (2): Pop, Time\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n```{.r .cell-code}\nskim(popdata)\n```\n\n::: {.cell-output-display}\nTable: Data summary\n\n|                         |        |\n|:------------------------|:-------|\n|Name                     |popdata |\n|Number of rows           |984656  |\n|Number of columns        |7       |\n|_______________________  |        |\n|Column type frequency:   |        |\n|character                |5       |\n|numeric                  |2       |\n|________________________ |        |\n|Group variables          |None    |\n\n\n**Variable type: character**\n\n|skim_variable | n_missing| complete_rate| min| max| empty| n_unique| whitespace|\n|:-------------|---------:|-------------:|---:|---:|-----:|--------:|----------:|\n|PA            |         0|             1|   4|  23|     0|       55|          0|\n|SZ            |         0|             1|   4|  29|     0|      335|          0|\n|AG            |         0|             1|   6|  11|     0|       19|          0|\n|Sex           |         0|             1|   5|   7|     0|        2|          0|\n|TOD           |         0|             1|   6|  39|     0|        8|          0|\n\n\n**Variable type: numeric**\n\n|skim_variable | n_missing| complete_rate|    mean|     sd|   p0|  p25|  p50|  p75| p100|hist  |\n|:-------------|---------:|-------------:|-------:|------:|----:|----:|----:|----:|----:|:-----|\n|Pop           |         0|             1|   39.86| 132.25|    0|    0|    0|   10| 2860|▇▁▁▁▁ |\n|Time          |         0|             1| 2015.51|   2.88| 2011| 2013| 2016| 2018| 2020|▇▇▇▇▇ |\n:::\n:::\n\n\n:::\n\n## Data Preparation\n\nOnly selected variables from year 2020 will be used for the study:  \n\n* YOUNG: age group 0 to 4 until age groyup 20 to 24,\n* ECONOMY ACTIVE: age group 25-29 until age group 60-64,\n* AGED: age group 65 and above,\n* TOTAL: all age group, and\n* DEPENDENCY: the ratio between young and aged against economy active group\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Preparing the attribute dataframe\n\npopdata2020 <- popdata %>%\n  filter(Time == 2020) %>%\n  group_by(PA, SZ, AG) %>%\n  summarise(`POP` = sum(`Pop`)) %>%\n  ungroup()%>%\n  pivot_wider(names_from=AG, \n              values_from=POP) %>%\n  mutate(YOUNG = rowSums(.[3:6])\n         +rowSums(.[12])) %>%\nmutate(`ECONOMICALLY ACTIVE` = rowSums(.[7:11])+\nrowSums(.[13:15]))%>%\nmutate(`AGED`=rowSums(.[16:21])) %>%\nmutate(`TOTAL`=rowSums(.[3:21])) %>%  \nmutate(`DEPENDENCY` = (`YOUNG` + `AGED`)\n/`ECONOMICALLY ACTIVE`) %>%\n  select(`PA`, `SZ`, `YOUNG`, \n       `ECONOMICALLY ACTIVE`, `AGED`, \n       `TOTAL`, `DEPENDENCY`)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'PA', 'SZ'. You can override using the\n`.groups` argument.\n```\n:::\n:::\n\n### Standardising uppercase of fields \n\n::: {.cell}\n\n```{.r .cell-code}\npopdata2020 <- popdata2020 %>%\n  mutate(PA = toupper(PA), \n         SZ = toupper(SZ)) %>%\n  filter(`ECONOMICALLY ACTIVE` > 0)\n```\n:::\n\n\n### Left join on identifier\n`left_join()` of dplyr is used to join the geographical data and attribute table using planning subzone name e.g. SUBZONE_N and SZ as the common identifier.\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz_pop2020 <- left_join(\n  mpsz, \n  popdata2020,\n  by = c(\"SUBZONE_N\" = \"SZ\"))\n```\n:::\n\n\n### write rds file\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(mpsz_pop2020, \"data/rds/mpszpop2020.rds\")\n```\n:::\n\n\n## Choropleth Mapping Geospatial Data Using `tmap`\n\n### Using `qtm()`\n\nThis creates a quick cartographic standard choropleth map:  \n\n* `tmap_mode()` with “plot” option is used to produce a static map. For interactive mode, “view” option should be used.\n* `fill` argument is used to map the attribute (i.e. DEPENDENCY)\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntmap_mode(\"plot\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\ntmap mode set to plotting\n```\n:::\n\n```{.r .cell-code}\nqtm(mpsz_pop2020, \n    fill = \"DEPENDENCY\")\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex08_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n##  Using tmap’s elements\n\n`tmap` has highly customizable options, with more control over map aesthetics:\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_pop2020)+\n  tm_fill(\n    \"DEPENDENCY\", \n    style = \"quantile\", \n    palette = \"Purples\",\n    title = \"Dependency ratio\"\n  ) +\n  tm_layout(\n    main.title = \"Distribution of Dependency Ratio by planning subzone\",\n    main.title.position = \"center\",\n    main.title.size = 1.2,\n    legend.height = 0.45, \n    legend.width = 0.3,\n    frame = FALSE,\n    bg.color = \"#F8F3E6\"\n  ) +\n  tm_borders(alpha = 0.3) +\n  tm_compass(\n    type=\"8star\", \n    size = 1\n  ) +\n  tm_scale_bar() +\n  tm_grid(alpha =0.2) +\n  tm_credits(\n    \"Source: Planning Sub-zone boundary from URA\\n and Population data from Department of Statistics DOS\", \n   position = c(\"left\", \"bottom\")\n  )\n```\n\n::: {.cell-output-display}\n![](Hands-on_Ex08_files/figure-html/unnamed-chunk-9-1.png){width=768}\n:::\n:::\n",
    "supporting": [
      "Hands-on_Ex08_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}